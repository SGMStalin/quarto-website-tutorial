---
title: Unidad 2
---


## Paquetes utilizados en esta lección

```{r}
#| warning: false
#| message: false

library(sf)
library(tidyverse)
library(tmap)
```


## Actividad 1. Clases, atributos y valores

**A partir del fichero "data/gpkg/estaciones_inamhi.gpkg", cargue la capa "Estaciones meteorologicas"**

```{r}
inamhi_stat <- st_read("data/gpkg/estaciones_inamhi.gpkg", layer = "Estaciones meteorologicas")
```


**Explore los datos cargados e intente responder las siguientes preguntas:**

- ¿Cuál es el la extensión máxima que alcanza la capa?

```{r}
st_bbox(inamhi_stat)
```

- ¿Cuál es el CRS de la capa?

```{r}
st_crs(inamhi_stat)
```

- ¿Cómo se llama la estación que tiene el Código INAMHI M0033?

```{r}
inamhi_stat[inamhi_stat$Codigo == "M0033", c("Codigo", "Nombre")] |> 
  st_drop_geometry()
```

- Visualice los datos en un mapa.

```{r}
#| message: false

tmap_mode("view")
qtm(inamhi_stat, symbols.col = "Estado")
```


## Actividad 2. Filtrado de vectores

**En su documento de Rmd escriba el código para cargar los datos de la capa "data/gpkg/muestreo.gpkg: Puntos de muestreo" y cargar la capa "data/gpkg/muestreo.gpkg: Demarcación hidrológica Santiago)**

```{r}
#| message: false

samp_points <- st_read("data/gpkg/muestreo.gpkg", layer = "Puntos de muestreo")

dhs <- st_read("data/gpkg/muestreo.gpkg", layer = "Demarcacion hidrogafica Santiago")
```


**Usando las herramientas hasta ahora aprendidas intente responder las siguientes preguntas:**

- ¿Cuál es el promedio de temperatura del aire de los puntos de muestreo que están bajo la cota de 1000 m?

```{r}
subset(samp_points, Altitud < 1000) %>%
  .$ta_media |> mean()
```


- Sin repetir el procedimiento para la pregunta anterior, encuentre el promedio y desviación estándar para los puntos de muestreo que sobrepasan el umbral de 50% de Porcentaje de bosque en el 2010.

```{r}
samp_points |>
  group_by(per = Forest_P_2010 > 50) |>
  summarise(
    ta_mean = mean(ta_media, na.rm = T),
    ta_sd = mean(ta_media, na.rm = T)
    )
```

- ¿Cuántos puntos de muestreo existen en el área que cubre la Demarcación hidrológica Santiago? 

```{r}
samp_in_dhs <- samp_points[st_intersects(samp_points, dhs, sparse = F), ]

nrow(samp_in_dhs)
```

- A partir de los puntos seleccionados, ¿Cuál es la extensión máxima de la selección?

```{r}
st_bbox(samp_in_dhs)
```


## Actividad 3. Estilos y etiquetas de vectores

**Usando datos de la capa "data/gpkg/muestreo.gpkg: Puntos de muestreo" y la Demarcación Hidrográfica del Río Santiago.**

- Seleccione los puntos que pertenezcan a la Cuenca y que estén a más de 2800 msnm.

```{r}
samp_points$in_dhs <- st_intersects(samp_points, dhs, sparse = F) & 
  samp_points$Altitud > 2800
```

- Grafique los puntos esos con color azul y sobre el polígono de la Cuenca.

- Los demás puntos grafiquelos con un color gris claro y con otra forma diferent

```{r}
qtm(dhs, fill = "grey30") +
  tm_shape(samp_points) +
  tm_dots(
    col = "in_dhs", palette = c("TRUE" = 'darkblue', "FALSE" = 'grey75'), title = "Conditions?"
  )
```


